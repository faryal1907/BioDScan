# Bio-D-Scan: Bee Monitoring System

Bio-D-Scan is a real-time bee monitoring system that collects environmental data (temperature, humidity, bee counts) from a Raspberry Pi via MQTT, stores it in MongoDB, and displays it on a responsive Next.js dashboard. The system uses FastAPI as the backend to handle MQTT communication and API requests, with HiveMQ as the MQTT broker.

## Features

### Backend Features
- **FastAPI** REST API with automatic documentation (`/docs` and `/redoc`)
- **MongoDB** integration for persistent storage of sensor data
- **HiveMQ MQTT** integration for real-time data from Raspberry Pi
- **Real-time data** processing and analytics
- **CORS** support for seamless frontend integration

### Frontend Features
- **Next.js 14** with App Router
- **Responsive dashboard** with modern UI
- **Data visualization** with Chart.js for charts and graphs
- **Real-time data** fetching and display via polling
- **Data tables** with sorting and filtering

### Raspberry Pi Features
- Publishes sensor data (temperature, humidity, bee counts) to HiveMQ MQTT broker
- Configurable MQTT topic and QoS settings
- Simulates realistic bee monitoring data (customizable)

## üõ†Ô∏è Technology Stack

### Backend
- **Python 3.11**
- **FastAPI 0.104.1**
- **Uvicorn 0.24.0**
- **Pydantic 2.5.0**
- **Motor 3.3.1** (Async MongoDB driver)
- **Paho-MQTT 1.6.1** (MQTT client)
- **Python-dotenv 1.1.1**

### Frontend
- **Next.js 14**
- **React 18**
- **TypeScript**
- **Tailwind CSS**
- **Chart.js** for data visualization

### Raspberry Pi
- **Python 3.8+**
- **Paho-MQTT 1.6.1**

### Infrastructure
- **HiveMQ Cloud** (MQTT broker)
- **MongoDB** (local or MongoDB Atlas)

## üìã Prerequisites

- **Python 3.11** or higher (for backend and Raspberry Pi)
- **Node.js 18** or higher (for frontend)
- **MongoDB** (local instance or MongoDB Atlas account)
- **HiveMQ Cloud** account (or self-hosted HiveMQ broker)
- **Git**
- **Raspberry Pi** with Python and `paho-mqtt` installed

## üîß Installation & Setup

### 1. Clone the Repository
```bash
git clone <repository-url>
cd bio-d-scan
```

### 2. MongoDB Setup
- **Local MongoDB**:
  - Install MongoDB Community Edition: [MongoDB Installation Guide](https://www.mongodb.com/docs/manual/installation/)
  - Start MongoDB: `mongod --dbpath <your-data-path>`
  - Default connection: `mongodb://localhost:27017`
- **MongoDB Atlas**:
  - Create a free cluster at [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
  - Get the connection string (e.g., `mongodb+srv://<username>:<password>@cluster0.mongodb.net/<dbname>`)
  - Update `.env` with the connection string (see Backend Setup)

### 3. Backend Setup
```bash
cd backend

# Create virtual environment
python -m venv venv

# Activate virtual environment (Windows)
.\venv\Scripts\Activate.ps1
# OR (Linux/Mac)
source venv/bin/activate

# Install dependencies
pip install fastapi uvicorn pydantic motor paho-mqtt python-dotenv
```

Create a `.env` file in the `backend` directory:
```env
MONGO_URI=mongodb://localhost:27017/bio_d_scan
HIVEMQ_BROKER=your-cluster-id.s1.eu.hivemq.cloud
HIVEMQ_PORT=8883
HIVEMQ_USERNAME=your-username
HIVEMQ_PASSWORD=your-password
HIVEMQ_TOPIC=sensors/bee-data
```

### 4. Frontend Setup
```bash
cd frontend

# Install dependencies
npm install
```

Update `frontend/.env.local` with the backend API URL:
```env
NEXT_PUBLIC_API_URL=http://localhost:8000
```

### 5. Raspberry Pi Setup
- Install Python 3.8+ and `paho-mqtt`: `pip install paho-mqtt`
- Copy the Raspberry Pi script (provided below) to the Pi
- Update the script with HiveMQ credentials and topic
- Run script: `python pi_publisher.py`

## üöÄ Running the Application

### Backend Development Server
```bash
cd backend

# Activate virtual environment
.\venv\Scripts\Activate.ps1  # Windows
# OR
source venv/bin/activate  # Linux/Mac

# Start the server
python -m uvicorn app.main:app --reload
```

**Backend will be available at:** `http://localhost:8000`

### Frontend Development Server
```bash
cd frontend

# Start the development server
npm run dev
```

**Frontend will be available at:** `http://localhost:3000`

### Raspberry Pi MQTT Publisher
On the Raspberry Pi:
```bash
python pi_publisher.py
```

## üìä Data Structure
The Raspberry Pi publishes data to the `sensors/bee-data` topic in the following JSON format:
```json
{
  "hive_id": "HIVE-001",
  "temperature": 22.5,
  "humidity": 65.2,
  "bumble_bee_count": 3,
  "honey_bee_count": 8,
  "lady_bug_count": 1,
  "location": "North Field",
  "notes": "Automated reading from HIVE-001",
  "timestamp": "2025-01-15T10:30:00"
}
```

The backend stores this data verbatim in MongoDB and serves it to the frontend.

## üîç Data Characteristics
- **Temperature**: 10-30¬∞C, with daily variations (¬±8¬∞C)
- **Humidity**: 30-90%, inversely related to temperature
- **Bee Activity**: Peaks from 8:00 AM to 6:00 PM, influenced by temperature (optimal: 15-25¬∞C)
- **Timestamp**: ISO 8601 format, generated by the Raspberry Pi

##  API Endpoints
### Core Endpoints
- `GET /api/bee-data`: Retrieve all bee data from MongoDB
- `POST /api/bee-data`: Add new bee data (used internally by MQTT handler)
- `GET /api/stats`: Get statistics (e.g., average temperature, humidity, bee counts)
- `GET /api/bee-data/latest`: Get the latest bee data entry

### Frontend API
- `GET /api/data`: Proxy endpoint to fetch bee data
- `GET /api/data/latest`: Fetch the latest bee data for display

## üß™ Testing
### Test Backend API
```bash
# Test API endpoints
python test_api.py
```

### Test MongoDB Connection
```bash
# Test MongoDB connection
python -c "from app.database import test_connection; import asyncio; asyncio.run(test_connection())"
```

### Test MQTT Connection
- Ensure the Raspberry Pi is publishing data
- Check backend logs for received MQTT messages
- Verify data in MongoDB using a client like MongoDB Compass

## üêõ Troubleshooting
### Common Issues
1. **MongoDB Connection Issues**:
   - Verify `MONGO_URI` in `.env`
   - Ensure MongoDB is running or Atlas credentials are correct
   - Test connection: `python -m app.database test_connection`
2. **HiveMQ Connection Issues**:
   - Check `HIVEMQ_BROKER`, `USERNAME`, and `PASSWORD` in `.env`
   - Ensure port `8883` is open and TLS is enabled
   - Test with a standalone MQTT client (e.g., `mosquitto_sub`)
3. **Frontend Fetch Errors**:
   - Verify `NEXT_PUBLIC_API_URL` in `frontend/.env.local`
   - Ensure backend is running at `http://localhost:8000`
   - Check CORS settings in `app.main`
4. **Port Conflicts**:
   - Backend: Change port in `uvicorn` command (e.g., `--port 8001`)
   - Frontend: Update port in `package.json` scripts
5. **Raspberry Pi Issues**:
   - Ensure `paho-mqtt` is installed
   - Verify network connectivity to HiveMQ broker
   - Check logs for MQTT connection errors

## üìù Development Notes
- **MongoDB**: Data is stored in the `bio_d_scan` database, `bee_data` collection
- **MQTT**: Uses QoS 1 for reliable delivery; adjust in `pi_publisher.py` and `app.main` if needed
- **Real-Time Updates**: Frontend polls every 5 seconds; consider WebSockets for true real-time
- **Security**: Add JWT authentication for production API endpoints
- **Deployment**: Use Docker for production; configure environment variables securely

## üÜò Support
- Check `/docs` or `/redoc` when backend is running for API documentation
- Open an issue on GitHub
- Contact support via [HiveMQ Community](https://community.hivemq.com/) or [MongoDB Community](https://www.mongodb.com/community/forums/)

## Architecture Overview
- **Raspberry Pi (Node)**: Publishes bee monitoring data to `sensors/bee-data` topic via HiveMQ MQTT
- **FastAPI Backend**: Subscribes to MQTT topic, stores data in MongoDB, and exposes API endpoints
- **Next.js Frontend**: Fetches data from backend and displays it in a responsive dashboard
- **HiveMQ Broker**: Facilitates MQTT communication (HiveMQ Cloud recommended)
- **MongoDB**: Stores all sensor data for persistence and querying